<!--suppress TypeScriptValidateTypes -->
<p-fluid>
    <form>
        @for (tx of targetTransaction; track tx; let idx = $index) {
            <div class="flex flex-col card gap-2">
                <div class="flex flex-row gap-2 justify-between">
                    <div class="flex flex-col align-middle">
                        <div class="font-semibold align-middle text-center">{{this.getTitle(tx)}}</div>
                    </div>
                    <div class="flex flex-col justify-end">
                        <div class="flex flex-row gap-4">
                            <div class="flex flex-row gap-2">
                                <p-button *ngIf="canDeleteSplit(idx, tx)" pTooltip="Delete split" tooltipPosition="top"  icon="pi pi-minus" severity="secondary" (onClick)="deleteSplit(idx)" />
                                <p-button pTooltip="Refresh data" tooltipPosition="top"  icon="pi pi-refresh" severity="secondary" (onClick)="refresh()" />
                                <p-button pTooltip="Split" tooltipPosition="top"  icon="pi pi-link" severity="secondary" (onClick)="addSplit()" />
                                <p-button pTooltip="Add Comission" tooltipPosition="top"  icon="pi pi-cart-minus" severity="secondary" (onClick)="showCommissionSplit(idx)" />
                            </div>
                            <div class="flex flex-row">
                                <p-button *ngIf="canDeleteTransaction(tx)" pTooltip="Delete transaction" tooltipPosition="top"  icon="pi pi-trash" severity="danger" (onClick)="confirmDelete(idx)" />
                            </div>
                        </div>
                    </div>
                </div>

                <transaction-editor #editor [transaction]="tx" [shouldShowTitle]="false" [shouldShowRefresh]="false"></transaction-editor>

                <div class="flex flex-col justify-end gap-2">
                    <div class="flex gap-2">
                    </div>
                </div>
            </div>
        }


        <div class="flex mt-8">
            <div class="card flex flex-wrap gap-4 w-full justify-end">
<!--                <div class="flex flex-row items-center gap-2">-->
<!--                    <p-checkbox id="chkbox2" formControlName="skipRules" [binary]="true" />-->
<!--                    <label for="chkbox2">Skip rules</label>-->
<!--                </div>-->

                <div class="flex flex-col items-end gap-1">
                    <p-button [label]="getSaveButtonLabel()" [fluid]="false" (click)="saveAll()"></p-button>
                    <span class="text-base text-gray-600" *ngIf="getSaveButtonDescription()">
                        {{ getSaveButtonDescription() }}
                    </span>
                </div>
            </div>

        </div>
    </form>
</p-fluid>
<p-toast />
<p-confirmdialog></p-confirmdialog>

<p-dialog header="Add Expense split" [modal]="true" [(visible)]="showExpenseSplit" (onHide)="onHideExpenseSplit()" [style]="{ width: '50rem' }" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [maximizable]="true">
    <form [formGroup]="expenseSplitForm" *ngIf="expenseSplitForm">
        <div class="flex items-center gap-4 mb-4 text-balance">
            <label for="sourceAccount" class="font-semibold w-24">Account</label>
            <p-inputgroup>
                <input pInputText type="text" formControlName="sourceAccountName"
                       readonly="true"
                       placeholder="Account name"/>
            </p-inputgroup>
        </div>
        <div class="flex items-center gap-4 mb-4">
            <label for="title" class="font-semibold w-24">Title</label>
            <p-inputgroup>
                <input pInputText type="text" formControlName="title"
                       placeholder="Title"/>
            </p-inputgroup>
        </div>
        <div class="flex items-center gap-4 mb-8">
            <label for="amount" class="font-semibold w-24">Amount</label>
            <p-inputgroup>
                <p-inputnumber formControlName="amount"
                               mode="decimal"
                               [minFractionDigits]="0" [maxFractionDigits]="5"
                               placeholder="Amount"></p-inputnumber>
                <p-inputgroup-addon
                    [style]="{'color': 'deepskyblue'}">{{ expenseSplitForm.get('sourceCurrency')?.value }}
                </p-inputgroup-addon>
            </p-inputgroup>
            <small *ngIf="expenseSplitForm.get('amount')?.invalid && expenseSplitForm.get('amount')?.touched" class="p-error">
                Amount must be greater than 0 and less than the source amount
            </small>
        </div>
        <div class="flex justify-end gap-2">
            <p-button label="Cancel" severity="secondary" (click)="onHideExpenseSplit()" />
            <p-button label="Save" (click)="saveExpenseSplit()" />
        </div>
    </form>
</p-dialog>
