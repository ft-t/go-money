@if (visible) {
    <div class="spotlight-backdrop fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-24"
         (click)="onBackdropClick($event)">
        <div class="spotlight-panel bg-surface-0 dark:bg-surface-900 rounded-xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden border border-surface-200 dark:border-surface-700"
             (click)="$event.stopPropagation()">

            <!-- Header -->
            <div class="flex items-center justify-between px-4 py-3 border-b border-surface-200 dark:border-surface-700">
                <div class="flex items-center gap-2">
                    <i class="pi pi-bookmark text-lg"></i>
                    <span class="font-semibold text-lg">Transaction Snippets</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs text-surface-500 hidden sm:inline">
                        <kbd class="px-1.5 py-0.5 bg-surface-100 dark:bg-surface-800 rounded text-xs">Ctrl</kbd>
                        +
                        <kbd class="px-1.5 py-0.5 bg-surface-100 dark:bg-surface-800 rounded text-xs">K</kbd>
                    </span>
                    <p-button icon="pi pi-times"
                              severity="secondary"
                              [text]="true"
                              [rounded]="true"
                              (onClick)="close()" />
                </div>
            </div>

            <!-- Content -->
            <div class="max-h-80 overflow-y-auto">
                @if (snippets.length === 0) {
                    <div class="px-4 py-8 text-center text-surface-500">
                        <i class="pi pi-inbox text-4xl mb-3 block"></i>
                        <p>No snippets yet</p>
                        <p class="text-sm mt-1">Save your current transactions as a snippet</p>
                    </div>
                } @else {
                    <div class="divide-y divide-surface-100 dark:divide-surface-700">
                        @for (snippet of snippets; track snippet.id) {
                            <div class="px-4 py-3 hover:bg-surface-50 dark:hover:bg-surface-800 transition-colors">
                                <div class="flex items-center justify-between gap-2">
                                    <!-- Name (editable) -->
                                    <div class="flex-1 min-w-0">
                                        @if (editingSnippetId() === snippet.id) {
                                            <input pInputText
                                                   type="text"
                                                   [ngModel]="editingName()"
                                                   (ngModelChange)="editingName.set($event)"
                                                   (keydown)="onEditKeydown($event)"
                                                   (blur)="saveEditing()"
                                                   class="w-full text-sm"
                                                   autofocus />
                                        } @else {
                                            <div class="flex items-center gap-2 cursor-pointer group"
                                                 (dblclick)="startEditing(snippet.id, snippet.name)">
                                                <span class="font-medium truncate">{{ snippet.name }}</span>
                                                <i class="pi pi-pencil text-xs text-surface-400 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                            </div>
                                            <div class="text-xs text-surface-500 mt-0.5">
                                                {{ snippet.transactions.length }} transaction(s)
                                            </div>
                                        }
                                    </div>

                                    <!-- Actions -->
                                    <div class="flex items-center gap-1 flex-shrink-0">
                                        <p-button icon="pi pi-play"
                                                  pTooltip="Apply snippet"
                                                  tooltipPosition="top"
                                                  severity="success"
                                                  [text]="true"
                                                  [rounded]="true"
                                                  size="small"
                                                  (onClick)="onApply(snippet)" />
                                        <p-button icon="pi pi-refresh"
                                                  pTooltip="Update with current"
                                                  tooltipPosition="top"
                                                  severity="info"
                                                  [text]="true"
                                                  [rounded]="true"
                                                  size="small"
                                                  (onClick)="onUpdate(snippet)" />
                                        <p-button icon="pi pi-trash"
                                                  pTooltip="Delete snippet"
                                                  tooltipPosition="top"
                                                  severity="danger"
                                                  [text]="true"
                                                  [rounded]="true"
                                                  size="small"
                                                  (onClick)="onDelete(snippet)" />
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>

            <!-- Footer -->
            <div class="px-4 py-3 border-t border-surface-200 dark:border-surface-700 bg-surface-50 dark:bg-surface-800/50">
                <p-button label="Save Current as Snippet"
                          icon="pi pi-plus"
                          severity="secondary"
                          [fluid]="true"
                          (onClick)="onCreateNew()" />
            </div>
        </div>
    </div>
}

<p-confirmdialog />
